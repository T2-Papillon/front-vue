<script setup>
import axios from 'axios'
import { ref } from 'vue'
import ProjectTable from '../components/ProjectTable.vue'
import TaskTable from '../components/TaskTable.vue'
import { formatProjectData } from '@/utils/projectUtils'

const username = sessionStorage.getItem('NM')
const projects = ref([])
const tasks = ref([])

async function dashboardData() {
    try {
        const eno = sessionStorage.getItem('EN')
        const url = import.meta.env.VITE_API_URL + `/dashboard/emp/${eno}`
        const res = await axios.get(url)
        projects.value = res.data.projects.map((project) => formatProjectData(project))
        tasks.value = res.data.tasks
        console.log(tasks.value)
    } catch (e) {
        //this.$router.replace('/')
        console.log(e)
    }
}

dashboardData()
</script>
<template>
    <div class="dashboard-wrap">
        <div class="container inner">
            <div class="row align-items-start justify-content-between g-3">
                <div class="col-auto">
                    <div class="title-area">
                        <h2 class="h2">ÌôòÏòÅÌï©ÎãàÎã§! {{ username }}Îãòüí°</h2>
                        <p class="text-body-tertiary lh-sm mb-3">Ïñ¥Ï©åÍµ¨Ï†ÄÏ©åÍµ¨Ï†ÄÏ©åÍµ¨Ïñ¥Ï©åÍµ¨</p>
                    </div>
                </div>
            </div>
            <div class="row g-5 g-xl-10 mb-5 mb-xl-10">
                <div class="col-xl-4">
                    <div class="card">
                        <div class="card-body">
                            <p class="card-title">Ïò§Îäò ÌîÑÎ°úÏ†ùÌä∏ Í±¥Ïàò</p>
                            <h3 class="card-text">1 Í±¥</h3>
                        </div>
                    </div>
                </div>
                <div class="col-xl-4">
                    <div class="card">
                        <div class="card-body">
                            <p class="card-title">Ï†ÑÏùº ÌîÑÎ°úÏ†ùÌä∏ Í±¥Ïàò</p>
                            <h3 class="card-text">1 Í±¥</h3>
                        </div>
                    </div>
                </div>
                <div class="col-xl-4">
                    <div class="card">
                        <div class="card-body">
                            <p class="card-title">Ï†ÑÏ£º ÌîÑÎ°úÏ†ùÌä∏ Í±¥Ïàò</p>
                            <h3 class="card-text">1 Í±¥</h3>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row g-5 g-xl-10 mb-5 mb-xl-10">
                <div class="col-xl-4">
                    <div class="card">
                        <div class="card-body">
                            <p class="card-title">Ïò§Îäò ÌîÑÎ°úÏ†ùÌä∏ Í±¥Ïàò</p>
                            <h3 class="card-text">1 Í±¥</h3>
                        </div>
                    </div>
                </div>
                <div class="col-xl-4">
                    <div class="card">
                        <div class="card-body">
                            <p class="card-title">Ï†ÑÏùº ÌîÑÎ°úÏ†ùÌä∏ Í±¥Ïàò</p>
                            <h3 class="card-text">1 Í±¥</h3>
                        </div>
                    </div>
                </div>
                <div class="col-xl-4">
                    <div class="card">
                        <div class="card-body">
                            <p class="card-title">Ï†ÑÏ£º ÌîÑÎ°úÏ†ùÌä∏ Í±¥Ïàò</p>
                            <h3 class="card-text">1 Í±¥</h3>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row g-5 g-xl-10 mb-5 mb-xl-10">
                <div class="col">
                    <div class="card">
                        <div class="card-body">
                            <h3 class="card-title mb-4">ÌîÑÎ°úÏ†ùÌä∏ Î™©Î°ù</h3>
                            <div class="card-text">
                                <ProjectTable :projects="projects" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row g-5 g-xl-10 mb-5 mb-xl-10">
                <div class="col">
                    <div class="card">
                        <div class="card-body">
                            <h3 class="card-title mb-4">Îã¥Îãπ ÏóÖÎ¨¥ Î™©Î°ù</h3>
                            <div class="card-text">
                                <TaskTable :initialTasks="tasks" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row g-5 g-xl-10 mb-5 mb-xl-10">
                <div class="col-xl-6">
                    <div class="card">
                        <div class="card-body">
                            <p class="card-title">data</p>
                            <h3 class="card-text">1 Í±¥</h3>
                        </div>
                    </div>
                </div>
                <div class="col-xl-6">
                    <div class="card">
                        <div class="card-body">
                            <p class="card-title">data</p>
                            <h3 class="card-text">1 Í±¥</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<style scoped>
.dashboard-wrap {
    background-color: #f7fafc;
}
</style>
